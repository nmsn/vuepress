# HTTP权威指南

## 第一部分

## 第1章 HTTP概述

1.3.1 媒体类型

MIME（Multipurpose Internet Mail Extension, 多用途因特网邮件拓展）

最初设计是为了解决在不同的电子邮件系统之间搬移报文时存在的问题。MIME在电子邮件系统中工作得非常好，因此HTTP也采纳了它，用它来描述并标记多媒体内容

1.3.2 URI

服务器资源名被称为统一资源标识符（Uniform Resource Identifier， URI）

1.3.3 URL

统一资源定位符（URL）是资源标识符最常见的形式。URL表述了一台特定服务器上的某资源的特定位置。它们可以明确说明如何从一个准确、固定的位置获取资源

大部分URL都遵循一种标准格式，这种格式包含三个部分

- 方案（scheme）访问资源所使用的协议类型
- 服务器因特网地址
- 其余部分指定了Web服务器上的某些资源

现在，几乎所有URI都是URL

1.3.4 URN

统一资源名（URN）。URN是作为特定内容的唯一名称使用的，与目前的资源所在地无关

URN仍然处于试验阶段，未大范围使用

1.4 事务

一个HTTP事务由一条（从客户端发往服务端地）请求命令和一个（从服务端发回客户端的）响应结果组成。这种通信是通过HTTP报文的格式化数据块进行的

1.5 HTTP报文

HTTP报文都是纯文本，不是二进制代码，所以人们可以很方便地对其进行读写

HTTP报文包括一下三个部分

- 起始行
- 首部字段
- 主体

1.6 连接

TCP提供了

- 无差错地数据传输
- 按序传输（数据总是会按照发送的顺序到达）
- 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）

1.7 协议版本

1.8 Web的结构组件

- 代理
- 缓存
- 网关*
- 隧道*
- Agent代理

## 第2章 URL与资源

2.2 URL的语法

|组件|描述|默认值|
|---|---|---|
|方案|访问服务器以获取资源时要使用哪种协议|无|
|用户|某些方案访问资源时需要的用户名|匿名|
|密码|用户名后面可能要包含的密码，中间由冒号分隔|<Email地址>|
|主机|资源宿主服务器的主机名或点分IP地址|无|
|端口|资源宿主服务器正在监听的端口号。很多方案都有默认端口号（HTTP默认端口号80）|每个方案特有|
|路径|服务器上资源的本地名，由一个斜杠（/）将其与前面的URL组件分隔开来。路径组件的语法是与服务器和方案有关的|无|
|参数|某些方案会用这个组件来指定输入参数。参数为名/值对。URL中可以包含多个参数字段，它们相互之间以及与路径的其余部分之间用分号（；）分隔|无|
|查询|某些方案会用这个组件传递参数以激活应用程序（比如数据库、公告板、搜索引擎以及其他因特网网关）。查询组件的内容没有通用格式。用字符“？”将其与URL的其余部分分隔开来|无|
|片段|一小片或一部分资源的名字。引用对象时，不会将frag字段传送给服务器；这个字段是在客户端内部使用的。通过字符“#”将其与URL的其余部分分隔开来|无|

2.2.1 方案——使用什么协议

方案名大小写无关 http = HTTP

2.2.3 用户名和密码

eg: `ftp://anonymous:my_password@ftp.prep.ai.mit.edu/pub/gnu`

如果某应用程序使用的URL方案要求输入用户名和密码，比如FTP，但用户没有提供，它通常会插入一个默认的用户名和密码

2.2.7 片段

HTTP服务器通常只处理整个对象，而不是对象的片段，客户端不能将片段传送给服务器。浏览器从服务器获得了整个资源后，会根据片段来显示你感兴趣的那部分资源
<!-- 需要确认 -->

2.3 URL快捷方式

2.4 各种令人头疼的字符

URL是可移植的。它要统一地命名因特网上所有地资源，这也就意味着要通过各种不同的协议来传送这些资源。**这些协议在传输数据时都会使用不同的机制**

有些协议例如传输电子邮件的简单邮件传输协议SMTP，所使用的传输防范就会剥去一些特定的字符。为了避开这些问题，URL只能使用一些相对较小的、通用的安全字母表中的字符

设计者们还希望URL是可读的。因此，即使不可见、不可打印的字符能够穿过邮件程序，从而成为可移植的，也不能在URL中使用

2.4.1 URL字符集

US-ASCII使用7位二进制码来表示英文打字机提供的大多数按键和少数用于文本格式和硬件通知的不可打印控制字符

但US-ASCII并不支持各种全世界数十亿人使用的数百种非罗马语言中很常见的变体字符和二进制数据

因此将**转义序列**集成进去。通过转义序列，就可以使用US-ASCII字符集的有限子集对任意字符值或数据进行编码

这种转义表示法包含一个百分号， 后面跟着两个表示字符ASCII码的十六进制数

2.5 方案的世界

|方案|描述|
|---|---|
|http|超文本传输协议方案，除了没有用户名和密码外，与通用的URL格式相符。如果省略了端口，就默认为80。基本格式 `http://<host>:<port>/<path>?<query>#<frag>`|
|https|方案https和方案http是一对。唯一的区别在于方案https使用了网景的SSL，SSL为HTTP连接提供了端到端的加密机制。其语法与HTTP的语法相同，默认端口为443。基本格式`https://<host>:<port>/<path>?<query>#<frag>`|
|mailto|Mailto URL指向的是E-mail地址，由于E-mail的行为与其他方案都有所不同（它并不指向任何可以直接访问的对象），所以mailto URL的格式与标准URL的格式也有所不同。因特网E-mail地址的语法记录在RFC822中。基本格式`mailto:<RFC-822-addr-spec>`|
|ftp|文件传输协议URL可以用来从FTP服务器上下载或向其上载文件，并获取FTP服务器上的目录结构内容的列表。在Web和URL出现之前FTP就已经存在了。Web应用程序将FTP作为一种数据访问方案使用。基本格式`ftp://<user>:<password>@<host>:<port>/<path>;<params>`|
|rtsp,rtspu|RTSP URL是可以通过实时流转传输协议解析的音/视频媒体资源的标识符。方案rtspu中的u表示它是使用UDP协议来获取资源的。基本格式`rtsp://<user>:<password>@<host>:<port>/<path>`|
|file|方案file表示一台指定主机（通过本地磁盘、网络文件系统或其他一些文件共享系统）上可直接访问的文件。各字段都遵循通用格式。如果省略了主机名，就默认为正在使用URL的本地主机。基本格式`file://<host>/<path>`|
|news|根据RFC1036的定义，方案news用来访问一些特定的文章或新闻组，它有一个很独特的性质：news URL自身包含的信息不足以对资源进行定位|
|telnet|方案telnet用于访问交互式业务。它表示的并不是对象自身，而是可通过telnet协议访问的交互式应用程序。基本格式`telnet://<user>:<password>@<host>:<port>`|

## 第3章 HTTP报文

3.2.2 起始行

1. 请求行

2. 响应行

3. 方法

    常用HTTP方法

    |方法|描述|是否包含主体|
    |---|---|---|
    |GET|从服务器获取一份文档|否|
    |HEAD|只从服务器获取文档的首部|否|
    |POST|向服务器发送需要处理的数据|是|
    |PUT|将请求的主体部分存储在服务器上|是|
    |TRACE|对可能经过代理服务器传送到服务器上去的报文进行追踪|否|
    |OPTIONS|决定可以在服务器上执行哪些方法|否|
    |DELETE|从服务器上删除一份文档|否|

4. 状态码

    |整体范围|已定义范围|分类|
    |---|---|---|
    |100~199|100~101|信息提示|
    |200~299|200~206|成功|
    |300~399|300~305|重定向|
    |400~499|400~415|客户端错误|
    |500~599|500~505|服务端错误|

5. 原因短语

    原因短语为状态码提供了文本形式的解释。比如，在行HTTP/1.0 200 OK中，OK就是原因短语

3.2.3 首部（header）

  HTTP规范定义了几种首部字段。应用程序也可以随意发明自己所用的首部
3.3 方法

3.3.2 GET

3.3.3 HEAD

HEAD方法与GET方法的行为很类似，但服务器在响应中只返回首部。不会返回实体的主体部分。这就允许客户端在未获取实际资源的情况下，对资源的首部进行检查。使用HEAD可以：

- 在不获取资源的情况下了解资源的情况（比如，判断其类型）
- 通过查看响应中的状态码，看看某个对象是否存在
- 通过查看首部，测试资源是否被修改

3.3.4 PUT

与GET从服务器读取文档相反，PUT方法会向服务器写入文档。有些发布系统允许用户创建Web页面，并用PUT直接将其安装到Web服务器上去

PUT方法的语义就是让服务器用球球的主体部分来创建一个由所请求的URL命名的新文档，或者，如果那个URL已经存在的话，就用这个主体来替代它

因为PUT允许用户对内容进行修改，所以很多Web服务器都要求在执行PUT之前，用密码登录

3.3.5 POST

POST法国法起初是用来向服务器输入数据的。实际上，通常会用它来支持HTML的表单

3.3.6 TRACE

客户端发起一个请求时，这个请求可能要穿过防火墙、代理、网关或其他一些应用程序。每个中间节点都可能会修改原始的HTTP请求。TRACE方法允许客户端在最终将请求发送给服务器时，看看它变成了什么样子

TRACE请求会在目的服务器端发起一个“环回”诊断。行程的最后一站的服务器会弹回一条TRACE响应，并在响应主体中携带它受到的原始请求报文。这样客户端就可以查看在所有中间HTTP应用程序组成得到请求/响应链上，原始报文是否，以及如何被毁坏或修改过

TRACE方法主要用于诊断

TRACE嘉定中间应用程对各种不同类型请求的处理是相同的。但很多HTTP应用程序会根据方法大的不同做出不同的事情。TRACE并不提供区分这些方法的机制。通常，中间应用程序会自行决定对TRACE请求的处理方式

3.3.7 OPTIONS

OPTIONS方法请求Web服务器告知其支持的各种共呢个。可以询问服务器通常支持哪些方法

这为客户端应用程序提供了一种手段，使其不用实际访问那些资源就能判定访问各种资源的最优方式

3.3.8 DELETE

DELETE方法所作的事情就是请服务器删除请求URL所指定的资源。但是客户应用程序无法保证删除擦欧总一定会被执行。因为HTTP规范允许服务器在不通知客户端的情况下撤销请求
